{"version":3,"sources":["webpack:///./src/pages/movies/more-movie/more-movie.js"],"names":["app","getApp","util","require","Page","data","movies","navigateTitle","requestUrl","totalCount","isEmpty","hiddenLoading","disabledRemind","onLoad","options","category","dataUrl","globalData","doubanBase","my","setNavigationBar","title","color","backgroundColor","console","log","that","url","httpRequest","method","header","success","res","processDoubanData","fail","error","onPullDownRefresh","event","refreshUrl","http","showNavigationBarLoading","onReachBottom","nextUrl","moviesDouban","subjects","length","_this","setData","setTimeout","idx","subject","substring","temp","stars","convertToStarsArray","rating","average","coverageUrl","images","large","movieId","id","push","totalMovies","concat","hideNavigationBarLoading","stopPullDownRefresh","onReady","onMovieTap","currentTarget","dataset","movieid","navigateTo"],"mappings":"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","file":"pages/movies/more-movie/more-movie.js","sourcesContent":["// pages/movies/more-movie/more-movie.js\r\nvar app = getApp()\r\nvar util = require('../../../utils/util.js')\r\nPage({\r\n  data: {\r\n    movies: [],\r\n    navigateTitle: \"\",\r\n    requestUrl: \"\",\r\n    totalCount: 0,\r\n    isEmpty: true,\r\n    hiddenLoading:false,\r\n    disabledRemind:false\r\n  },\r\n  onLoad: function (options) {\r\n    var category = options.category;\r\n    this.data.navigateTitle = category;\r\n    var dataUrl = \"\";\r\n    switch (category) {\r\n      case \"正在热映\":\r\n        dataUrl = app.globalData.doubanBase +\r\n          \"/v2/movie/in_theaters\";\r\n        break;\r\n      case \"即将上映\":\r\n        dataUrl = app.globalData.doubanBase +\r\n          \"/v2/movie/coming_soon\";\r\n        break;\r\n      case \"豆瓣Top250\":\r\n        dataUrl = app.globalData.doubanBase + \"/v2/movie/top250\";\r\n        break;\r\n    }\r\n     my.setNavigationBar({\r\n          title: category,\r\n          color:\"#fff\",\r\n          backgroundColor: '#314C6D'\r\n    })\r\n    this.data.requestUrl = dataUrl;\r\n    console.log(this.data.requestUrl)\r\n    // util.http(dataUrl, this.processDoubanData)\r\n    var that = this\r\n    var url = dataUrl\r\n    my.httpRequest({\r\n      url: url,\r\n      method: 'GET',\r\n      header: {\r\n        \"Content-Type\": \"json\"\r\n      },\r\n      success: function (res) {\r\n        that.processDoubanData(res.data)\r\n        // console.log(res.data)\r\n      },\r\n      fail: function (error) {\r\n        // fail\r\n        console.log(error)\r\n      }\r\n    })\r\n  },\r\n  onPullDownRefresh: function (event) {\r\n    var refreshUrl = this.data.requestUrl +\r\n      \"?star=0&count=20\"\r\n    this.data.movies = {};\r\n    this.data.isEmpty = true;\r\n    this.data.totalCount = 0;\r\n    // console.log(refreshUrl)\r\n    util.http(refreshUrl, this.processDoubanData);\r\n    my.showNavigationBarLoading();\r\n  },\r\n  onReachBottom: function (event) {\r\n    // \b上滑加载\r\n    var nextUrl = this.data.requestUrl +\r\n      \"?start=\" + this.data.totalCount + \"&count=20\";\r\n    console.log(123)\r\n    var that=this\r\n    my.httpRequest({\r\n      url: nextUrl,\r\n      method: 'GET',\r\n      header: {\r\n        \"Content-Type\": \"json\"\r\n      },\r\n      success: function (res) {\r\n        that.processDoubanData(res.data)\r\n        // console.log(res.data)\r\n      },\r\n      fail: function (error) {\r\n        // fail\r\n        console.log(error)\r\n      }\r\n    })\r\n    my.showNavigationBarLoading()\r\n  },\r\n  processDoubanData: function (moviesDouban) {\r\n    var movies = [];\r\n    //没有更多啦\r\n    if(moviesDouban.subjects.length<=0){\r\n      var _this = this;\r\n      if(!_this.data.disabledRemind){\r\n        _this.setData({\r\n          disabledRemind: true\r\n        });\r\n        setTimeout(function(){\r\n          _this.setData({\r\n            disabledRemind: false\r\n          });\r\n        }, 2000);\r\n      }\r\n    }\r\n    for (var idx in moviesDouban.subjects) {\r\n      var subject = moviesDouban.subjects[idx];\r\n      var title = subject.title;\r\n      if (title.length >= 6) {\r\n        title = title.substring(0, 6) + \"...\";\r\n      }\r\n      // [1,1,1,1,1] [1,1,1,0,0]\r\n      var temp = {\r\n        stars: util.convertToStarsArray(subject.rating.stars),\r\n        title: title,\r\n        average: subject.rating.average,\r\n        coverageUrl: subject.images.large,\r\n        movieId: subject.id\r\n      }\r\n      movies.push(temp)\r\n    }\r\n    var totalMovies = {}\r\n\r\n    //如果要绑定新加载的数据，那么需要同旧有的数据合并在一起\r\n    if (!this.data.isEmpty) {\r\n      totalMovies = this.data.movies.concat(movies);\r\n    }\r\n    else {\r\n      totalMovies = movies;\r\n      this.data.isEmpty = false;\r\n    }\r\n    this.setData({\r\n      movies: totalMovies\r\n    });\r\n    this.data.totalCount += 20;\r\n    my.hideNavigationBarLoading();\r\n    my.stopPullDownRefresh()\r\n    this.setData({\r\n      hiddenLoading:true\r\n    })\r\n  },\r\n\r\n  onReady: function (event) {\r\n    my.setNavigationBar({\r\n      title: this.data.navigateTitle\r\n    })\r\n  },\r\n\r\n  onMovieTap: function (event) {\r\n    var movieId = event.currentTarget.dataset.movieid;\r\n    my.navigateTo({\r\n      url: '../movie-detail/movie-detail?id=' + movieId\r\n    })\r\n  },\r\n})\n\n\n// WEBPACK FOOTER //\n// ./src/pages/movies/more-movie/more-movie.js"],"sourceRoot":""}