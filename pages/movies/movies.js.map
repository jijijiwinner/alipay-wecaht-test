{"version":3,"sources":["webpack:///./src/pages/movies/movies.js"],"names":["util","require","app","getApp","Page","data","inTheaters","comingSoon","top250","searchResult","containerShow","searchPanelShow","onShareAppMessage","title","desc","path","onLoad","event","inTheatersUrl","globalData","doubanBase","comingSoonUrl","top250Url","getMovieListData","my","setNavigationBar","color","backgroundColor","onMoreTap","category","currentTarget","dataset","navigateTo","url","onMovieTap","movieId","settedKey","categoryTitle","showNavigationBarLoading","that","httpRequest","method","header","success","res","processDoubanData","fail","error","console","log","onCancelImgTap","setData","onBindFocus","onBindBlur","text","detail","value","searchUrl","moviesDouban","movies","idx","subjects","subject","length","substring","temp","stars","convertToStarsArray","rating","average","coverageUrl","images","large","id","push","readyData","hideNavigationBarLoading"],"mappings":"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","file":"pages/movies/movies.js","sourcesContent":["var util = require('../../utils/util.js')\r\nvar app = getApp();\r\nPage({\r\n  // RESTFul API JSON\r\n  // SOAP XML\r\n  //粒度 不是 力度\r\n  data: {\r\n    inTheaters: {},\r\n    comingSoon: {},\r\n    top250: {},\r\n    searchResult: {},\r\n    containerShow: true,\r\n    searchPanelShow: false,\r\n  },\r\n    onShareAppMessage: function () {\r\n    return {\r\n      title: '光与影',\r\n      desc: '进入搜索电影吧',\r\n      path: '/pages/movies/movies'\r\n    }\r\n  },\r\n  onLoad: function (event) {\r\n    var inTheatersUrl = app.globalData.doubanBase +\r\n      \"/v2/movie/in_theaters\" + \"?start=0&count=6\";\r\n    var comingSoonUrl = app.globalData.doubanBase +\r\n      \"/v2/movie/coming_soon\" + \"?start=0&count=6\";\r\n    var top250Url = app.globalData.doubanBase +\r\n      \"/v2/movie/top250\" + \"?start=0&count=6\";\r\n\r\n    this.getMovieListData(inTheatersUrl, \"inTheaters\", \"正在热映\");\r\n    this.getMovieListData(comingSoonUrl, \"comingSoon\", \"即将上映\");\r\n    this.getMovieListData(top250Url, \"top250\", \"豆瓣Top250\");\r\n    my.setNavigationBar({\r\n          title: '光与影',\r\n          color:\"#fff\",\r\n          backgroundColor: '#314C6D'\r\n    });\r\n  },\r\n  \r\n  onMoreTap: function (event) {\r\n    var category = event.currentTarget.dataset.category;\r\n    my.navigateTo({\r\n      url: \"more-movie/more-movie?category=\" + category\r\n    })\r\n  },\r\n\r\n  onMovieTap:function(event){\r\n    var movieId = event.currentTarget.dataset.movieId;\r\n    // console.log(event.currentTarget)\r\n    my.navigateTo({\r\n      url: \"movie-detail/movie-detail?id=\"+movieId\r\n    })\r\n  },\r\n\r\n  getMovieListData: function (url, settedKey, categoryTitle) {\r\n    my.showNavigationBarLoading()\r\n    var that = this;\r\n    my.httpRequest({\r\n      url: url,\r\n      method: 'GET', // OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, CONNECT\r\n      header: {\r\n        \"Content-Type\": \"json\"\r\n      },\r\n      success: function (res) {\r\n        that.processDoubanData(res.data, settedKey, categoryTitle)\r\n      },\r\n      fail: function (error) {\r\n        // fail\r\n        console.log(error)\r\n      }\r\n    })\r\n  },\r\n\r\n  onCancelImgTap: function (event) {\r\n      this.setData({\r\n        containerShow: true,\r\n        searchPanelShow: false,\r\n        searchResult:{}\r\n      }\r\n    )\r\n  },\r\n\r\n  onBindFocus: function (event) {\r\n    this.setData({\r\n      containerShow: false,\r\n      searchPanelShow: true\r\n    })\r\n  },\r\n\r\n  onBindBlur: function (event) {\r\n    var text = event.detail.value;\r\n    var searchUrl = app.globalData.doubanBase + \"/v2/movie/search?q=\" + text;\r\n    this.getMovieListData(searchUrl, \"searchResult\", \"\");\r\n  },\r\n\r\n  processDoubanData: function (moviesDouban, settedKey, categoryTitle) {\r\n    var movies = [];\r\n    for (var idx in moviesDouban.subjects) {\r\n      var subject = moviesDouban.subjects[idx];\r\n      var title = subject.title;\r\n      if (title.length >= 6) {\r\n        title = title.substring(0, 6) + \"...\";\r\n      }\r\n      // [1,1,1,1,1] [1,1,1,0,0]\r\n      var temp = {\r\n        stars: util.convertToStarsArray(subject.rating.stars),\r\n        title: title,\r\n        average: subject.rating.average,\r\n        coverageUrl: subject.images.large,\r\n        movieId: subject.id\r\n      }\r\n      movies.push(temp)\r\n    }\r\n    var readyData = {};\r\n    readyData[settedKey] = {\r\n      categoryTitle: categoryTitle,\r\n      movies: movies\r\n    }\r\n    this.setData(readyData);\r\n    console.log(readyData)\r\n    my.hideNavigationBarLoading();\r\n  }\r\n})\n\n\n// WEBPACK FOOTER //\n// ./src/pages/movies/movies.js"],"sourceRoot":""}